<div class="flower-list">
    <!-- Header + Add Button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="title">Flowers</h3>
        <button class="btn text-white add-btn" (click)="openAddModal(addFlowerModal)">
            <i class="bi bi-plus-lg"></i> Add Flower
        </button>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="filter-item" [class.selected]="stockFilter === ''" (click)="setStockFilter('')">
            <i class="bi bi-list"></i> All Stock
        </div>
        <div class="filter-item" [class.selected]="stockFilter === 'true'" (click)="setStockFilter('true')">
            <i class="bi bi-check-circle"></i> In Stock
        </div>
        <div class="filter-item" [class.selected]="stockFilter === 'false'" (click)="setStockFilter('false')">
            <i class="bi bi-x-circle"></i> Out of Stock
        </div>
        <div class="filter-item">
            <i class="bi bi-search"></i>
            <input type="text" class="form-control search-input" placeholder="Search by name..."
                [(ngModel)]="searchTerm" (input)="filterFlowers()">
        </div>
        <div class="filter-item reset" (click)="resetFilters()">
            <i class="bi bi-arrow-counterclockwise"></i> Reset Filter
        </div>
    </div>

    <!-- Loader -->
    <div *ngIf="loading" class="text-center my-5">
        <div class="spinner-border" [style.color]="'#BDA577'" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- No Results -->
    <div *ngIf="!loading && filteredFlowers.length === 0" class="no-results">
        No flowers match your filters.
    </div>

    <!-- Flower Grid -->
    <div class="row g-4">
        <div class="col-md-3 col-sm-6" *ngFor="let flower of filteredFlowers">
            <div class="card flower-card h-100 shadow-sm">
                <img [src]="flower.image" class="card-img-top" alt="{{flower.Name}}">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{flower.Name}}</h5>
                    <p class="card-text">{{flower.Description}}</p>
                    <p class="fw-bold mt-auto">${{flower.Price}}</p>
                    <span class="badge mt-2" [ngClass]="flower.in_stock ? 'bg-success' : 'bg-danger'">
                        {{flower.in_stock ? 'In Stock' : 'Out of Stock'}}
                    </span>
                    <div class="card-actions">
                        <button class="btn btn-custom btn-sm" (click)="editFlower(flower, addFlowerModal)">
                            <i class="bi bi-pencil-square"></i> Edit
                        </button>
                        <button class="btn btn-danger btn-sm" (click)="deleteFlower(flower)">
                            <i class="bi bi-trash"></i> Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Flower Modal -->
    <ng-template #addFlowerModal let-modal>
        <div class="modal-header modal-header-custom">
            <h5 class="modal-title">{{editingFlower ? 'Edit Flower' : 'Add Flower'}}</h5>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
        </div>
        <div class="modal-body">
            <form [formGroup]="addFlowerForm">
                <div class="mb-3">
                    <label>Name</label>
                    <input type="text" class="form-control" formControlName="Name">
                    <div class="text-danger" *ngIf="f['Name'].touched && f['Name'].invalid">
                        <small *ngIf="f['Name'].errors?.['required']">Name is required.</small>
                    </div>
                </div>

                <div class="mb-3">
                    <label>Description</label>
                    <textarea class="form-control" formControlName="Description"></textarea>
                    <div class="text-danger" *ngIf="f['Description'].touched && f['Description'].invalid">
                        <small *ngIf="f['Description'].errors?.['required']">Description is required.</small>
                    </div>
                </div>

                <div class="mb-3">
                    <label>Price</label>
                    <input type="number" class="form-control" formControlName="Price">
                    <div class="text-danger" *ngIf="f['Price'].touched && f['Price'].invalid">
                        <small *ngIf="f['Price'].errors?.['required']">Price is required.</small>
                        <small *ngIf="f['Price'].errors?.['min']">Price must be at least 1.</small>
                    </div>
                </div>

                <div class="mb-3">
                    <label>Stock Count</label>
                    <input type="number" class="form-control" formControlName="stock_count">
                    <div class="text-danger" *ngIf="f['stock_count'].touched && f['stock_count'].invalid">
                        <small *ngIf="f['stock_count'].errors?.['required']">Stock count is required.</small>
                        <small *ngIf="f['stock_count'].errors?.['min']">Stock count cannot be negative.</small>
                    </div>
                </div>

                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" formControlName="in_stock" id="stockCheck">
                    <label for="stockCheck" class="form-check-label">In Stock</label>
                </div>

                <div class="mb-3">
                    <label>Image</label>
                    <input type="file" class="form-control" (change)="onFileChange($event)">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
            <button class="btn text-white add-btn" [disabled]="submitting" (click)="submitFlower(modal)">
                <span *ngIf="submitting" class="spinner-border spinner-border-sm"></span>
                Save
            </button>
        </div>
    </ng-template>
</div>