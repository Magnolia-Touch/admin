<div class="subscription-list">
    <h3 class="title">Cleaning Services</h3>

    <div class="filter-bar">
        <div class="filter-item">
            <i class="bi bi-list"></i>
            <select [(ngModel)]="selectedStatus" (change)="loadServices()">
                <option value="">All Status</option>
                <option *ngFor="let s of cleaningStatuses" [value]="s">{{ s }}</option>
            </select>
        </div>

        <div class="filter-item">
            <i class="bi bi-calendar"></i>
            <input placeholder="Created Date" name="selectedDate" ngbDatepicker #d1="ngbDatepicker" readonly
                (click)="d1.toggle()" [(ngModel)]="selectedDate" (dateSelect)="loadServices()" />
        </div>

        <div class="filter-item">
            <i class="bi bi-calendar"></i>
            <input placeholder="First Cleaning Date" name="firstCleaningDate" ngbDatepicker #d2="ngbDatepicker" readonly
                (click)="d2.toggle()" [(ngModel)]="firstCleaningDate" (dateSelect)="loadServices()" />
        </div>

        <div class="filter-item reset" (click)="resetFilters()">
            <i class="bi bi-arrow-counterclockwise"></i> Reset Filter
        </div>
    </div>

    <div *ngIf="loading" class="text-center my-3">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div *ngIf="!loading && services.length === 0" class="no-results">
        No services match your filters.
    </div>

    <div *ngIf="!loading">
        <div class="subscription-card" *ngFor="let service of services">
            <div class="customer-info">
                <strong>{{ service.booking_ids }}</strong>
                <small>Status: {{ service.status }}</small>
            </div>
            <div class="service-type">
                Amount: {{ service.amount }}
            </div>
            <div class="service-date">
                First Cleaning: {{ service.first_cleaning_date | date:'dd/MM/yyyy' }}
            </div>
            <div class="service-date">
                Created: {{ service.createdAt | date:'dd/MM/yyyy' }}
            </div>
            <div class="view-btn">
                <button (click)="openDetailModal(orderDetailModal, service)">View Details</button>
                <button class="btn-status ms-1" (click)="openStatusModal(changeStatusModal, service)">
                    Change Status
                </button>
            </div>
        </div>

        <nav *ngIf="totalPages > 1" aria-label="Page navigation">
            <ul class="pagination justify-content-center mt-3">

                <!-- Previous Button -->
                <li class="page-item" [class.disabled]="page === 1">
                    <button class="page-link" (click)="pageChange(page - 1)">Previous</button>
                </li>

                <!-- Page Numbers -->
                <li class="page-item" *ngFor="let p of pagesArray()" [class.active]="p === page"
                    [class.disabled]="p === '...'">
                    <button class="page-link" *ngIf="p !== '...'; else dots" (click)="pageChange(p)">
                        {{ p }}
                    </button>
                    <ng-template #dots>
                        <span class="page-link">â€¦</span>
                    </ng-template>
                </li>

                <!-- Next Button -->
                <li class="page-item" [class.disabled]="page === totalPages">
                    <button class="page-link" (click)="pageChange(page + 1)">Next</button>
                </li>

            </ul>
        </nav>
    </div>
</div>

<ng-template #orderDetailModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">Service Details - {{ selectedService?.booking_ids }}</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
        <p><strong>Status:</strong> {{ selectedService?.status }}</p>
        <p><strong>Amount:</strong> {{ selectedService?.amount }}</p>
        <p><strong>First Cleaning Date:</strong> {{ selectedService?.first_cleaning_date | date:'dd/MM/yyyy' }}</p>
        <p><strong>Created At:</strong> {{ selectedService?.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
        <p><strong>Notes:</strong> {{ selectedService?.notes || 'N/A' }}</p>
    </div>
</ng-template>

<ng-template #changeStatusModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">Change Status - {{ selectedService?.booking_ids }}</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>

    <div class="modal-body">
        <label for="statusSelect"><strong>Select New Status:</strong></label>
        <select id="statusSelect" [(ngModel)]="newStatus" class="form-select mt-2">
            <option *ngFor="let s of cleaningStatuses" [value]="s">{{ s }}</option>
        </select>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="updateStatus(modal)">Update</button>
    </div>
</ng-template>