<div class="subscription-list">
    <h3 class="title">Memorial List</h3>

    <div class="filter-bar">
        <div class="filter-item">
            <i class="bi bi-list"></i>
            <select [(ngModel)]="selectedStatus" (change)="loadMemorials()">
                <option value="">All Status</option>
                <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
            </select>
        </div>
        <div class="filter-item">
            <i class="bi bi-search"></i>
            <input type="text" class="search-input" placeholder="Search by Order Number" [(ngModel)]="orderNumber"
                (input)="loadMemorials()">
        </div>
        <div class="filter-item">
            <i class="bi bi-calendar"></i>
            <input class="datepicker-input" placeholder="Created Date" name="selectedDate" ngbDatepicker
                #d="ngbDatepicker" readonly (click)="d.toggle()" (dateSelect)="loadMemorials()"
                [(ngModel)]="selectedDate" />
        </div>
        <div class="filter-item reset" (click)="resetFilters()">
            <i class="bi bi-arrow-counterclockwise"></i> Reset Filter
        </div>
    </div>

    <div *ngIf="loading" class="text-center my-3">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div *ngIf="!loading && orders.length === 0" class="no-results">
        No orders match your filters.
    </div>

    <div *ngIf="!loading">
        <div class="subscription-card" *ngFor="let order of orders">
            <div class="customer-info">
                <strong>{{ order.orderNumber }}</strong>
                <small>Status: {{ order.status }}</small>
            </div>
            <div class="service-type">
                Amount: {{ order.totalAmount }}
            </div>
            <div class="service-date">
                Created: {{ order.createdAt | date:'dd/MM/yyyy' }}
            </div>
            <div class="view-btn">
                <button (click)="openDetailModal(orderDetailModal, order)">View Details</button>
            </div>
        </div>

        <nav *ngIf="total > limit" aria-label="Page navigation">
            <ul class="pagination justify-content-center mt-3">
                <li class="page-item" [class.disabled]="page === 1">
                    <button class="page-link" (click)="pageChange(page - 1)">Previous</button>
                </li>
                <li class="page-item disabled">
                    <span class="page-link">Page {{ page }}</span>
                </li>
                <li class="page-item" [class.disabled]="page * limit >= total">
                    <button class="page-link" (click)="pageChange(page + 1)">Next</button>
                </li>
            </ul>
        </nav>
    </div>

</div>

<ng-template #orderDetailModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">Order Details - {{ selectedOrder?.orderNumber }}</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
        <p><strong>Status:</strong> {{ selectedOrder?.status }}</p>
        <p><strong>Total Amount:</strong> {{ selectedOrder?.totalAmount }}</p>
        <p><strong>Notes:</strong> {{ selectedOrder?.notes || 'N/A' }}</p>
        <p><strong>Created At:</strong> {{ selectedOrder?.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
    </div>
</ng-template>